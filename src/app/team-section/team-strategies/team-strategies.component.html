<div class="card-with-margins">
  <igx-expansion-panel>
    <igx-expansion-panel-header>
      <igx-expansion-panel-title>
        Map Filter for Strategies
      </igx-expansion-panel-title>
      <igx-expansion-panel-description>
        {{ selectedMaps }}
      </igx-expansion-panel-description>
      <button class="navigation-item" *ngIf="changes && isAdmin" igxButton="raised" igxRipple (click)="saveMaps($event)">Save current maps</button>
      <button class="navigation-item" *ngIf="isEditor" igxButton="raised" igxRipple (click)="openNewStrategy($event)">Add new strategy</button>
    </igx-expansion-panel-header>
    <igx-expansion-panel-body>
      <app-map-pool [mapPool]="maps" [readOnly]="false" (update)="changeMaps($event)">
      </app-map-pool>
    </igx-expansion-panel-body>
  </igx-expansion-panel>
  <div class="card-wrapper">
    <igx-card class="map-column strat" *ngFor="let strat of teamStrats | sidestrats:maps:pipeTrigger">
      <igx-card-header>
        <h5>{{ strat.Title }}</h5>
        <div class="admin-actions" *ngIf="isEditor">
          <button igxButton="flat" igxRipple (click)="editStrategy(strat)">
            <igx-icon title="edit strategy">edit</igx-icon>
            Edit
          </button>
          <button igxButton="flat" igxRipple (click)="confirm.open(strat)">
            <igx-icon class="margin-left" title="delete strategy">delete_forever</igx-icon>
            Delete
          </button>
        </div>
      </igx-card-header>
      <igx-card-content>
        <p>{{ strat.Description }}</p>
        <iframe class="youtube-frame" *ngIf="isYoutube(strat.Url)" [src]="strat.Url | safeVideoLink" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </igx-card-content>
    </igx-card>
  </div>
</div>

<!-- New strategy dialog-->
<igx-dialog closeOnOutsideSelect="true" (onClose)="resetStrategy()">
  <form #strategyForm="ngForm" (ngSubmit)="submitStrategy()" class="new-strategy">
    <igx-list>
      <igx-list-item [isHeader]="true">Add a new team strategy</igx-list-item>
      <igx-list-item>
        <igx-input-group>
          <label for="strategyName" igxLabel>Title</label>
          <input #strategyName name="strategyName" id="strategyName" igxInput minlength="2" required [(ngModel)]="newStrategy.Title">
          <igx-suffix *ngIf="strategyName.value.length > 0" (click)="strategyName.value = ''">
              <igx-icon>clear</igx-icon>
          </igx-suffix>
        </igx-input-group>
      </igx-list-item>
      <igx-list-item>
        <igx-input-group>
          <label for="strategyDescription" igxLabel>Description</label>
          <textarea #strategyDescription id="strategyDescription" name="strategyDescription" igxInput minlength="2" required [(ngModel)]="newStrategy.Description">
          </textarea>
          <igx-suffix *ngIf="strategyDescription.value.length > 0" (click)="strategyDescription.value = ''">
              <igx-icon>clear</igx-icon>
          </igx-suffix>
        </igx-input-group>
      </igx-list-item>
      <igx-list-item>
        <igx-radio name="strategySide" [(ngModel)]="newStrategy.Side" [value]="0">
          T-Side
        </igx-radio>
        <igx-radio name="strategySide" [(ngModel)]="newStrategy.Side" [value]="1">
          CT-Side
        </igx-radio>
      </igx-list-item>
      <igx-list-item>
        <button type="button" name="strategyMap" igxButton="flat" [igxToggleAction]="mapPicker" igxRipple>
          Map: {{ newStrategy.Map | mapname }}
          <igx-icon fontSet="material">arrow_drop_down</igx-icon>
        </button>
        <igx-drop-down #mapPicker (onSelection)="selectMap($event)">
          <igx-drop-down-item *ngFor="let map of mapList" [value]="map.id" [isSelected]="map.id === newStrategy.Map">
            {{ map.map }}
          </igx-drop-down-item>
        </igx-drop-down>
      </igx-list-item>
      <igx-list-item>
        <igx-input-group>
          <igx-prefix>
            <igx-icon>link</igx-icon>
          </igx-prefix>
          <label for="strategyUrl" igxLabel>Link to a video/resource</label>
          <input #strategyUrl name="strategyUrl" id="strategyUrl" igxInput placeholder="Link to a video/resource" pattern="^(?:http(s)?:\/\/)[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$" [(ngModel)]="newStrategy.Url">
          <igx-suffix *ngIf="strategyUrl.value.length > 0" (click)="strategyUrl.value = ''">
              <igx-icon>clear</igx-icon>
          </igx-suffix>
        </igx-input-group>
      </igx-list-item>
      <igx-list-item *ngIf="getVideoEmbedLink()">
        <iframe class="youtube-frame" [src]="newStrategy.Url | safeVideoLink" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </igx-list-item>
      <igx-list-item>
        <button igxButton igxRipple [disabled]="strategyForm.invalid">Submit</button>
      </igx-list-item>
    </igx-list>
  </form>
</igx-dialog>
<!-- END New strategy dialog -->

<!-- Confirm -->
<app-confirm #confirm title="Are you sure?" (ok)="deleteStrat($event)">
  Pressing OK will permanently remove this strategy...
</app-confirm>
<!-- END Confirm -->